SC_01. 분류 작업 시작, 종료 제어 시나리오 
트리거:
관리자가 GUI에서 "분류시작", "분류종료", "일시정지" 버튼 클릭

컨베이어 벨트 입구 IR 센서에 물품 감지

10초간 물품 미감지

참여자:
GUI, API Server, Service Layer, TCP Handler, Sort Controller(ESP32)

Flow:
A. 분류 시작 시나리오:
시작 명령 발생

관리자가 GUI에서 "분류시작" 버튼 클릭

GUI에서 REST API 요청 전송: POST /api/inbound/start

시스템 상태 확인

Service Layer는 현재 분류기 상태 확인

분류기 상태가 이미 "RUNNING"인 경우:

WebSocket으로 GUI에 메시지 전송: {"event_type": "info", "message": "이미 작동 중입니다", "auto_dismiss": 1000}

요청 중단

분류기 상태가 "PAUSED"인 경우:

일시정지에서 재개 작업 진행

분류기 상태가 "STOPPED"인 경우:

정지에서 시작 작업 진행

하드웨어 제어 명령 전송

TCP Handler는 Sort Controller로 TCP 메시지 전송: SCst\n

Sort Controller는 명령 수신 후 다음 작업 수행:

컨베이어 벨트 모터 작동 (모터 제어 핀을 HIGH로 설정)

바코드 스캐너 활성화 (스캐너 전원 제어 핀을 HIGH로 설정)

모든 센서 활성화

Sort Controller는 작동 완료 후 응답 메시지 전송: SRok\n

GUI 상태 업데이트

TCP Handler는 응답을 수신하여 Service Layer로 전달

응답이 성공적인 경우에만 Service Layer는 분류기 상태 업데이트:

분류기 상태를 "RUNNING"으로 변경

WebSocket을 통해 GUI로 상태 업데이트 전송: {"event_type": "status_update", "status": "running"}

GUI는 다음과 같이 업데이트:

상태 표시를 "작동 중"으로 변경 (녹색)

"분류시작" 버튼 비활성화

"분류종료" 버튼 활성화

"일시정지" 버튼 활성화

B. 분류 종료 시나리오:
종료 명령 발생

관리자가 GUI에서 "분류종료" 버튼 클릭

또는 Sort Controller가 10초간 IR 센서 미감지 상태 감지

GUI에서 종료 버튼 클릭 시 REST API 요청 전송: POST /api/inbound/stop

Sort Controller에서 자동 감지 시 이벤트 메시지 전송: SEas\n

시스템 상태 확인

Service Layer는 현재 분류기 상태 확인

분류기 상태가 "RUNNING" 또는 "PAUSED"가 아닌 경우:

WebSocket으로 GUI에 메시지 전송: {"event_type": "info", "message": "분류기가 작동 중이 아닙니다", "auto_dismiss": 1000}

요청 중단

분류기 상태가 "RUNNING" 또는 "PAUSED"인 경우 다음 단계로 진행

대기 물품 확인

Service Layer는 현재 메모리에 저장된 대기 물품 수 확인

대기 물품이 있는 경우(값 > 0):

WebSocket을 통해 GUI에 경고 메시지 전송: {"event_type": "warning", "message": "아직 처리 중인 물품이 있습니다", "auto_dismiss": 1000}

종료 작업 중단, 입고 상태 유지

대기 물품이 없는 경우(값 = 0) 다음 단계로 진행

하드웨어 제어 명령 전송

TCP Handler는 Sort Controller로 TCP 메시지 전송: SCsp\n

Sort Controller는 명령 수신 후 다음 작업 수행:

컨베이어 벨트 모터 정지 (모터 제어 핀을 LOW로 설정)

바코드 스캐너 비활성화 (스캐너 전원 제어 핀을 LOW로 설정)

모든 센서 비활성화 (필요에 따라)

Sort Controller는 정지 완료 후 응답 메시지 전송: SRok\n

GUI 상태 업데이트

TCP Handler는 응답을 수신하여 Service Layer로 전달

응답이 성공적인 경우에만 Service Layer는 분류기 상태 업데이트:

분류기 상태를 "STOPPED"로 변경

WebSocket을 통해 GUI로 상태 업데이트 전송: {"event_type": "status_update", "status": "stopped"}

GUI는 다음과 같이 업데이트:

상태 표시를 "분류 종료"로 변경 (회색)

"분류시작" 버튼 활성화

"분류종료" 버튼 비활성화

"일시정지" 버튼 비활성화

C. 일시정지 시나리오:
일시정지 명령 발생

관리자가 GUI에서 "일시정지" 버튼 클릭

GUI에서 REST API 요청 전송: POST /api/inbound/pause

시스템 상태 확인

Service Layer는 현재 분류기 상태 확인

분류기 상태가 "RUNNING"이 아닌 경우:

WebSocket으로 GUI에 메시지 전송: {"event_type": "info", "message": "분류기가 작동 중이 아닙니다", "auto_dismiss": 1000}

요청 중단

분류기 상태가 "RUNNING"인 경우 다음 단계로 진행

하드웨어 제어 명령 전송

TCP Handler는 Sort Controller로 TCP 메시지 전송: SCps\n

Sort Controller는 명령 수신 후 다음 작업 수행:

컨베이어 벨트 모터 정지 (모터 제어 핀을 LOW로 설정)

바코드 스캐너 및 센서는 활성 상태 유지

Sort Controller는 일시정지 완료 후 응답 메시지 전송: SRok\n

GUI 상태 업데이트

TCP Handler는 응답을 수신하여 Service Layer로 전달

응답이 성공적인 경우에만 Service Layer는 분류기 상태 업데이트:

분류기 상태를 "PAUSED"로 변경

WebSocket을 통해 GUI로 상태 업데이트 전송: {"event_type": "status_update", "status": "paused"}

GUI는 다음과 같이 업데이트:

상태 표시를 "일시정지"로 변경 (노란색)

"분류시작" 버튼 활성화 (재개 버튼으로 사용)

"분류종료" 버튼 활성화 상태 유지

"일시정지" 버튼 비활성화